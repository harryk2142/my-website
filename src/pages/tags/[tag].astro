---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION_SHORT } from "../../consts";
import Main from "../../components/Main.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");
  const allTags = new Set(allPosts.flatMap((p) => p.data.tags));
  console.log(allTags);

  const staticPaths = Array.from(allTags).map((tag) => {
    return {
      params: { tag },
      props: { posts: allPosts },
    };
  });
  return staticPaths;
}

const { tag } = Astro.params;
const { posts } = Astro.props;

const filtered = posts.filter((post) =>
  post.data.tags.includes(tag ? tag : "")
);
---

--- ---

<html lang="de">
  <head>
    <BaseHead
      title={SITE_TITLE}
      description={SITE_DESCRIPTION_SHORT}
      image={"icons/favicon-96x96.png"}
      type={"website"}
    />
  </head>
  <body>
    <Header title={tag} />
    <Main class="">
      <h2>#{tag}</h2>
      <div>
        <ul>
          {
            filtered.map((post) => (
              <li>
                <a href={`/blog/${post.slug}/`}>{post.data.title}</a>
              </li>
            ))
          }
        </ul>
      </div>
    </Main>
    <Footer />
  </body>
  <style>
    div {
      margin-top: 6rem;
    }
    div > * {
    }
  </style>
</html>
